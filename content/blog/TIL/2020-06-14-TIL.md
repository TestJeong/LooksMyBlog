---
title: '20.06.14 TIL'
date: 2020-06-14 12:21:13
category: 'TIL'
draft: false
---

uploadì—ì„œ íŒŒì¼ì„ ì˜¬ë¦¬ëŠ” ê²ƒë¿ë§Œ ì•„ë‹ˆë¼ ì¹´ë©”ë¼ë¥¼ í†µí•´ì„œ ë°”ë¡œ ë…¹í™”í•˜ì—¬ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•œ í›„ ì—…ë¡œë“œí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ êµ¬í˜„í•´ ë´…ë‹ˆë‹¤
```js
function init() {
  recordBtn.addEventListener("click", getVideo);
}

if (recorderContainer) {
  init();
}

```

**recorderContainer**ì— ê°’ì´ ìˆìœ¼ë©´ `init()` í•¨ìˆ˜ê°€ ì‹¤í–‰ì´ ëœë‹¤ ì´ í•¨ìˆ˜ì—ëŠ” ì´ë²¤íŠ¸ê°€ ìˆëŠ”ë° **recordBtn**ì„ í´ë¦­í•˜ë©´ `getVideo` í•¨ìˆ˜ê°€ ì‹¤í–‰ì´ëœë‹¤.

```js
let streamObject;
let videoRecorder;

const getVideo = async () => {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      audio: true,
      video: {
        width: 1280,
        height: 720,
      },
    });
    videoPreview.srcObject = stream;
    videoPreview.muted = true;
    videoPreview.play();
    recordBtn.innerHTML = "Stop recording";
    streamObject = stream;
    startRecording();
  } catch (error) {
    recordBtn.innerHTML = "ğŸ”´ Cant record";
  } finally {
    recordBtn.removeEventListener("click", getVideo);
  }
};

```

**getVideo**ëŠ” **async**ë¥¼ ì‚¬ìš©í•˜ì—¬ `getUserMedia` ë©”ì„œë“œë¥¼ ë°›ì„ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤ ì—¬ê¸°ì„œ `getUserMedia`ëŠ” ì‰½ê²Œ ë§í•´ ì´ë ‡ê²Œ í˜¸ì¶œë§Œ í•˜ë©´ ì›¹ìº , ë§ˆì´í¬ ì…ë ¥ì„ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤ ì •í™•í•œ ì •ì˜ëŠ” ì•„ë˜ì™€ ê°™ë‹¤

<span style="color: #60b4a6">(ì‚¬ìš©ìì—ê²Œ ë¯¸ë””ì–´ ì…ë ¥ ì¥ì¹˜ ì‚¬ìš© ê¶Œí•œì„ ìš”ì²­í•˜ë©°, ì‚¬ìš©ìê°€ ìˆ˜ë½í•˜ë©´ ìš”ì²­í•œ ë¯¸ë””ì–´ ì¢…ë¥˜ì˜ íŠ¸ë™ì„ í¬í•¨í•œ MediaStreamì„ ë°˜í™˜í•©ë‹ˆë‹¤. ìŠ¤íŠ¸ë¦¼ì€ ì¹´ë©”ë¼, ë¹„ë””ì˜¤ ë…¹í™” ì¥ì¹˜, ìŠ¤í¬ë¦° ê³µìœ  ì¥ì¹˜ ë“± í•˜ë“œì›¨ì–´ì™€ ê°€ì¥ ë¹„ë””ì˜¤ ì†ŒìŠ¤ê°€ ìƒì„±í•˜ëŠ” ë¹„ë””ì˜¤ íŠ¸ë™ê³¼, ë§ˆì´í¬, A/D ë³€í™˜ê¸° ë“± ë¬¼ë¦¬ì ê³¼ ê°€ìƒ ì˜¤ë””ì˜¤ ì¥ì¹˜ê°€ ìƒì„±í•˜ëŠ” ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼, ê·¸ë¦¬ê³  ê·¸ ì™¸ì˜ ë‹¤ë¥¸ ì¢…ë¥˜ì˜ ìŠ¤íŠ¸ë¦¼ì„ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)</span>

[ì°¸ì¡° - Developer_Mozilla](https://developer.mozilla.org/ko/docs/Web/API/MediaDevices/getUserMedia)

ì´ë ‡ê²Œ `getUserMedia()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ë°˜í™˜ê°’ìœ¼ë¡œ **MediaStream**ì´ ë°˜í™˜í•˜ëŠ”ë° ì´ê±´ ì‚¬ìš©ìì˜ ë””ë°”ì´ìŠ¤ì—ì„œ ì¹´ë©”ë¼ë‚˜ ë§ˆì´í¬ ê°™ì€ ì¥ë¹„ë“¤ì˜ ìŠ¤íŠ¸ë¦¼ì„ ì–»ì–´ë‚´ëŠ” ì—­í• ì„ í•œë‹¤ ì¦‰ ê°€ì ¸ì˜¨ ë¯¸ë””ì–´ëŠ” ì—¬ê¸°ì— ì €ì¥ëœë‹¤.

![](./images/20200614TIl.png)

[ìœ„ ì‚¬ì§„ì´ ë°˜í™˜ë˜ëŠ” MediaStream ì´ë‹¤] 

`getVideo`í•¨ìˆ˜ì—ì„œ `videoPreview.srcObject = stream`ì€ **stream** ìì²´ê°€ ê°ì²´ì´ê¸°ì— **srcObject**ë¡œ **url**ë¥¼ ì²˜ë¦¬í•œë‹¤ ë…¹í™” ì¤‘ì— ì˜ìƒ ì†Œë¦¬ê¸° ë‚˜ì§€ ì•Šê²Œ muted ì²˜ë¦¬ë¥¼ í•´ì¤€ í›„ `play()`ë¥¼ í•˜ë©´ `startrecording()` í•¨ìˆ˜ê°€ ì‹¤í–‰ëœë‹¤

**streamObject** ê¸€ë¡œë²Œ ë³€ìˆ˜ì— `stream`ì„ ëŒ€ì…ì‹œì¼œì¤€ë‹¤ 

```js
const startRecording = () => {
  videoRecorder = new MediaRecorder(streamObject);
  videoRecorder.start();
  videoRecorder.addEventListener("dataavailable", handleVideoData);
  recordBtn.addEventListener("click", stopRecording);
};

```

`getVideo()` í•¨ìˆ˜ì—ì„œëŠ” ì¹´ë©”ë¼ì™€ ì˜¤ë””ì˜¤ ê¸°ëŠ¥ì„ ê·¸ëƒ¥ ê°€ì ¸ì˜¤ê¸°ë§Œ í–ˆë‹¤  ì´ì œ `startRecording()` í•¨ìˆ˜ë¥¼ í†µí•´ ë¹„ë””ì˜¤ë¥¼ ë…¹í™”í•˜ê³  ì €ì¥í•˜ë ¤ í•œë‹¤ **MediaRecorder**ëŠ” ë¯¸ë””ì–´ë¥¼ ì‰½ê²Œ ê¸°ë¡ í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•´ ì¤€ë‹¤ `getUserMedia()`ê°€ ìƒì„±í•œ ìŠ¤íŠ¸ë¦¼ì„ ë°›ëŠ”ë‹¤

![](./images/20200614TIl-record.png)

`videoRecorder.start()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ë ˆì½”ë”©ì„ ì‹œì‘í•œë‹¤ ê·¸ëŸ¼ ì´ì œ ë¯¸ë””ì–´ ì†ŒìŠ¤( getUserMedia() ) ì— **Blob** í˜•íƒœë¡œ ë°ì´í„°ê°€ ì €ì¥ì´ ë˜ê³  ë ˆì½”ë”©ì„ ëë‚´ê³  ì‹¶ìœ¼ë©´ recordBtn ë²„íŠ¼ì„ ëˆŒëŸ¬ `stopRecording()` í•¨ìˆ˜ê°€ ì‹¤í–‰ì´ ë˜ë©´ì„œ **dataavailable**ì˜ `handleVideoData` ì´ë²¤íŠ¸ í•¨ìˆ˜ê°€ ì‹¤í–‰ì´ ëœë‹¤

<span style="color: #60b4a6">( dataavailable : videoê°€ ì •ì§€ë˜ë©´ í•¨ìˆ˜ê°€ ì‹¤í–‰)</span>

```js
const handleVideoData = (event) => {
  const {
    data: videoFile
  } = event;
  const link = document.createElement("a");
  link.href = URL.createObjectURL(videoFile);
  link.download = "recorded.webm"
  document.body.appendChild(link);
  link.click();
};

```

ë ˆì½”ë”©ì´ ë©ˆì¶”ë©´ `handleVideoData()` ê°€ ì‹¤í–‰ì´ë˜ì–´ ì €ì¥ë˜ì–´ ìˆë˜ **Blob** ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤ **link**ë¼ëŠ” ë³€ìˆ˜ë¥¼ ìƒˆë¡œ ë§Œë“¤ì–´ **a** íƒœê·¸ë¥¼ ë§Œë“  í›„ ë§í¬ë¡œ `videoFile(blob)`ì„ ì¤€ë‹¤

`URL.createObjectURL(videoFile)`ì€
Blob ê°ì²´ì— ê°€ìƒì˜ URLì„ ë¶€ì—¬í•  ìˆ˜ ìˆë‹¤. ì´ ë°©ì‹ì„ ì‚¬ìš©í•˜ë©´ BlobëŠ” ë¬¼ë¡  Blobë¥¼ ìƒì†í•œ File ê°ì²´ì—ë„ URLì„ ë¶€ì—¬í•  ìˆ˜ ìˆê²Œ ë˜ëŠ”ë° ì´ Blob URLì€ ìƒì„±ëœ windowì˜ documentì—ì„œë§Œ(ë¸Œë¼ìš°ì €) ìœ íš¨í•˜ê³  ë‹¤ë¥¸ windowì—ì„œ ì¬í™œìš©í•  ìˆ˜ ì—†ìœ¼ë©°, URLì˜ ìˆ˜ëª…ì´ í•œì •ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— **file:url** ê³¼ ë‹¤ë¥´ê²Œ ë³´ì•ˆ ì´ìŠˆì—ì„œ ë²—ì–´ë‚  ìˆ˜ ìˆë‹¤.

![](./images/20200614blob.png)

**ë…¸ë§ˆë“œ ì½”ë” [We-Tube] ê°•ì˜ë¥¼ ë“£ê³  ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.**